#!/bin/bash

if [ -z "$TESTS" ]; then
  TESTS=(wfqueue wfqueue0 delay faa lcrq ccqueue msqueue)
else
  IFS=':' read -r -a TESTS <<< "${TESTS}"
fi

if [ -z "$PROCS" ]; then
  PROCS=(1 2 4 8)
else
  IFS=':' read -r -a PROCS <<< "${PROCS}"
fi

printf 'Host: %s\n' $( hostname )
printf 'Benchmarks: %s\n' $( IFS=$','; echo "${TESTS[*]}" )
printf 'Threads: %s\n' $( IFS=$','; echo "${PROCS[*]}" )

for i in ${TESTS[@]}; do
  for j in ${PROCS[@]}; do
    echo -e "$i $j \
      $(./driver ./$i $j | tail -n 1 | awk '{print $3,$5}')"
  done
done
